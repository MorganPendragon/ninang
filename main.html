<!DOCTYPE html>
<html lang="en">

<head>
    <title>Our Final Webpage</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <!-- <script src="app.js"></script> -->
    <script src="night.js"></script>
    <link rel="stylesheet" href="app.css">

    <head>
        <div class="app-header">
            <div class="app-header-left">
                <span class="app-icon"></span>
                <p class="app-name">To Do List</p>
                <div class="search-wrapper">
                    <input class="search-input" type="text" placeholder="Search">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor"
                        stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="feather feather-search"
                        viewBox="0 0 24 24">
                        <defs></defs>
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="M21 21l-4.35-4.35"></path>
                    </svg>
                </div>
            </div>
            <div class="app-header-right">
                <button class="mode-switch" title="Switch Theme">
                    <svg class="moon" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                        stroke-width="2" width="24" height="24" viewBox="0 0 24 24">
                        <defs></defs>
                        <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
                </button>
                <button class="add-btn" title="Add New Project">
                    <svg class="btn-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"
                        stroke-linejoin="round" class="feather feather-plus">
                        <line x1="12" y1="5" x2="12" y2="19" />
                        <line x1="5" y1="12" x2="19" y2="12" />
                    </svg>
                </button>
                <button class="notification-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="feather feather-bell">
                        <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9" />
                        <path d="M13.73 21a2 2 0 0 1-3.46 0" />
                    </svg>
                </button>
                <button class="profile-btn">
                    <img src="WIN_20220429_18_12_27_Pro.jpg" />
                    <span>Jamila F.</span>
                </button>
            </div>
            <button class="messages-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="feather feather-message-circle">
                    <path
                        d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z" />
                </svg>
            </button>
        </div>
    </head>

<body>
    <div class="app-container">
        <div class="app-content">
            <div class="app-sidebar">
                <a href="" class="app-sidebar-link active">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="feather feather-home">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
                        <polyline points="9 22 9 12 15 12 15 22" />
                    </svg>
                </a>
                <a href="calendar.html" class="app-sidebar-link">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="feather feather-calendar">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                        <line x1="16" y1="2" x2="16" y2="6" />
                        <line x1="8" y1="2" x2="8" y2="6" />
                        <line x1="3" y1="10" x2="21" y2="10" />
                    </svg>
                </a>
            </div>
            <div class="projects-section">
                <div class="projects-section-header">
                    <p>Projects</p>
                    <p class="time"> </p>
                </div>
                <div class="projects-section-line">
                    <div class="projects-status">
                    </div>
                    <div class="view-actions">
                        <button class="view-btn list-view" title="List View">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" class="feather feather-list">
                                <line x1="8" y1="6" x2="21" y2="6" />
                                <line x1="8" y1="12" x2="21" y2="12" />
                                <line x1="8" y1="18" x2="21" y2="18" />
                                <line x1="3" y1="6" x2="3.01" y2="6" />
                                <line x1="3" y1="12" x2="3.01" y2="12" />
                                <line x1="3" y1="18" x2="3.01" y2="18" />
                            </svg>
                        </button>
                        <button class="view-btn grid-view active" title="Grid View">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" class="feather feather-grid">
                                <rect x="3" y="3" width="7" height="7" />
                                <rect x="14" y="3" width="7" height="7" />
                                <rect x="14" y="14" width="7" height="7" />
                                <rect x="3" y="14" width="7" height="7" />
                            </svg>
                        </button>
                    </div>
                </div>
                <!-- Modal for Task Manager -->
                <div id="taskManagerModal" class="modal">
                    <div class="modal-content">
                        <span class="close-modal">&times;</span>
                        <div class="task-manager">
                            <h2>Task Manager</h2>
                            <div class="task">
                                <input type="text" id="taskName" placeholder="Enter Task">
                                <select id="priority">
                                    <option value="High">High Priority</option>
                                    <option value="Medium">Medium Priority</option>
                                    <option value="Low">Low Priority</option>
                                </select>
                                <input type="date" id="deadline" placeholder="Deadline">

                                <label>Subtasks (max 4):</label>
                                <input type="text" class="subtask-input" placeholder="Subtask 1">
                                <input type="text" class="subtask-input" placeholder="Subtask 2">
                                <input type="text" class="subtask-input" placeholder="Subtask 3">
                                <input type="text" class="subtask-input" placeholder="Subtask 4">

                                <button id="addTask">Add Task</button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Project Boxes Section -->
                <div class="project-boxes jsGridView" id="projectBoxes">
                    <!-- Existing project boxes will be here -->

                </div>
            </div>
            <div class="messages-section">
                <button class="messages-close">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="feather feather-x-circle">
                        <circle cx="12" cy="12" r="10" />
                        <line x1="15" y1="9" x2="9" y2="15" />
                        <line x1="9" y1="9" x2="15" y2="15" />
                    </svg>
                </button>
                <div class="projects-section-header">
                    <p>Goals</p>
                </div>
                <div class="messages">
                    <div class="message-box">
                        <div class="message-content">
                            <div class="message-header">
                                <div class="item-status">
                                    <span class="status-number deadline-past">0</span>
                                    <span class="status-type">Deadline Past</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="message-box">
                        <div class="message-content">
                            <div class="message-header">
                                <div class="item-status">
                                    <span class="status-number working-on-it">0</span>
                                    <span class="status-type">Working on it</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="message-box">

                        <div class="message-content">
                            <div class="message-header">
                                <div class="item-status">
                                    <span class="status-number total-tasks">0</span>
                                    <span class="status-type">Total Task List</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="message-box">

                        <div class="message-content">
                            <div class="message-header">
                                <div class="item-status">
                                    <span class="status-number completed-tasks">0</span>
                                    <span class="status-type">Completed Task List</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</div>
</body>

<script>
    document.addEventListener('DOMContentLoaded', function () {
    const supabaseUrl = 'https://hddkqyxhojtgvlautvzx.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhkZGtxeXhob2p0Z3ZsYXV0dnp4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzg1NTI4ODUsImV4cCI6MjA1NDEyODg4NX0.4FAo2vDcCCjgDACSnJXiDaA_gktK5XgoYTuOPcIG2Cg'; // Replace with your API key';
    const database = supabase.createClient(supabaseUrl, supabaseKey);

    console.log('Supabase client initialized:', database);

    let isEditMode = false; // Track if we're in edit mode
    let currentTaskId = null; // Track the task being edited

    const modal = document.getElementById('taskManagerModal');
    const addBtn = document.querySelector('.add-btn');
    const closeModalBtn = document.querySelector('.close-modal');
    const addTaskBtn = document.getElementById('addTask');

    // Open modal when "Add New Project" button is clicked
    addBtn.addEventListener('click', () => {
        modal.style.display = 'flex'; // Show the modal
        clearForm(); // Clear the form when opening the modal
    });

    // Close modal when the close button is clicked
    closeModalBtn.addEventListener('click', () => {
        modal.style.display = 'none'; // Hide the modal
    });

    // Close modal when clicking outside the modal
    window.addEventListener('click', (event) => {
        if (event.target === modal) {
            modal.style.display = 'none'; // Hide the modal
        }
    });

    // Ensure the event listener is only added once
    addTaskBtn.removeEventListener('click', handleAddTask); // Remove existing listener
    addTaskBtn.addEventListener('click', handleAddTask); // Add new listener

    function handleAddTask() {
        addTask().then(() => {
            modal.style.display = 'none'; // Hide the modal after adding/editing
        });
    }

    function getRandomColor() {
        const colors = ["#fee4cb", "#e9e7fd", "#ffd3e2", "#c8f7dc", "#d5deff"];
        return colors[Math.floor(Math.random() * colors.length)];
    }

    async function addTask() {
        let taskName = document.getElementById("taskName").value;
        let priority = document.getElementById("priority").value;
        let dueDate = document.getElementById("deadline").value;

        // Collect subtasks from individual inputs
        const subtaskInputs = document.querySelectorAll('.subtask-input');
        let subTasks = Array.from(subtaskInputs)
            .map(input => input.value.trim())
            .filter(subTask => subTask !== "");

        if (!taskName || !dueDate) {
            alert("Please fill in all fields.");
            return;
        }

        // Validate subtask limit (max 4 subtasks)
        if (subTasks.length > 4) {
            alert("You can only add up to 4 subtasks.");
            return;
        }

        if (isEditMode) {
            // Update existing task
            await editTask(currentTaskId, taskName, priority, dueDate, subTasks);
            isEditMode = false; // Exit edit mode
            currentTaskId = null; // Reset current task ID
            document.getElementById("addTask").textContent = "Add Task"; // Change button text back
        } else {
            // Add new task
            const { data, error } = await database
                .from('tasks')
                .insert([{ task_name: taskName, priority, progress: 0, due_date: dueDate }])
                .select();

            if (error) {
                console.error('Error inserting task:', error);
                alert('Failed to add task. Please try again.');
                return;
            }

            const taskId = data[0].id;

            if (subTasks.length > 0) {
                // Insert subtasks in order
                const subtaskInserts = subTasks.map((subTask, index) => ({
                    task_id: taskId,
                    subtask_name: subTask,
                    completed: false,
                    order: index + 1, // Add an order field to track the order
                }));
                await database.from('subtasks').insert(subtaskInserts);
            }
        }

        fetchTasks();
        clearForm(); // Clear the form after adding/editing
    }

    async function deleteTask(taskId) {
        await database.from('tasks').delete().eq('id', taskId);
        await database.from('subtasks').delete().eq('task_id', taskId);
        fetchTasks();
    }

    async function deleteSubtask(taskId, subtaskName) {
        await database.from('subtasks').delete().eq('task_id', taskId).eq('subtask_name', subtaskName);
        fetchTasks();
    }

    async function toggleSubtaskCompletion(taskId, subtaskName, isCompleted) {
        await database
            .from('subtasks')
            .update({ completed: isCompleted })
            .eq('task_id', taskId)
            .eq('subtask_name', subtaskName);

        updateProgressBar(taskId);
    }

    async function editTask(taskId, taskName, priority, dueDate, subTasks) {
        // Validate subtask limit (max 4 subtasks)
        if (subTasks.length > 4) {
            alert("You can only add up to 4 subtasks.");
            return;
        }

        // Update task details
        const { error: taskError } = await database
            .from('tasks')
            .update({ task_name: taskName, priority, due_date: dueDate })
            .eq('id', taskId);

        if (taskError) {
            console.error('Error updating task:', taskError);
            alert('Failed to update task. Please try again.');
            return;
        }

        // Fetch existing subtasks
        const { data: existingSubtasks, error: subtaskError } = await database
            .from('subtasks')
            .select('*')
            .eq('task_id', taskId);

        if (subtaskError) {
            console.error('Error fetching subtasks:', subtaskError);
            return;
        }

        // Delete existing subtasks
        await database.from('subtasks').delete().eq('task_id', taskId);

        // Insert updated subtasks in order
        if (subTasks.length > 0) {
            const subtaskInserts = subTasks.map((subTask, index) => ({
                task_id: taskId,
                subtask_name: subTask,
                completed: false,
                order: index + 1, // Add an order field to track the order
            }));
            await database.from('subtasks').insert(subtaskInserts);
        }
    }

    function updateProgressBar(taskId) {
        const subtaskCheckboxes = document.querySelectorAll(`.subtask-checkbox[data-task-id='${taskId}']`);
        const progressBar = document.querySelector(`.box-progress[data-task-id='${taskId}']`);
        const progressPercentage = document.querySelector(`.box-progress-percentage[data-task-id='${taskId}']`);
        const daysLeftText = document.querySelector(`.days-left[data-task-id='${taskId}']`);

        if (!progressBar || !progressPercentage || !daysLeftText) return;

        const totalSubtasks = subtaskCheckboxes.length;
        const completedSubtasks = Array.from(subtaskCheckboxes).filter(checkbox => checkbox.checked).length;
        const progress = totalSubtasks === 0 ? 0 : Math.round((completedSubtasks / totalSubtasks) * 100);

        progressBar.style.width = `${progress}%`;
        progressPercentage.textContent = `${progress}%`;

        if (progress === 100) {
            daysLeftText.textContent = "Completed";
            progressBar.style.backgroundColor = '#4CAF50';
        } else {
            const dueDate = daysLeftText.getAttribute('data-due-date');
            const daysLeft = calculateDaysLeft(dueDate);
            daysLeftText.textContent = daysLeft;
            progressBar.style.backgroundColor = '#ff942e';
        }

        // Update progress in the database
        database
            .from('tasks')
            .update({ progress: progress })
            .eq('id', taskId)
            .then(({ error }) => {
                if (error) {
                    console.error('Error updating progress:', error);
                } else {
                    // Refresh the calendar to reflect changes
                    fetchTasksAndRenderCalendar(database, calendar);
                }
            });
    }

    function updateCalendarEvent(taskId, progress) {
        if (!calendar) return; // Ensure the calendar is initialized

        // Find the event in the calendar
        const event = calendar.getEventById(taskId);

        if (event) {
            // Update the event's progress and color
            event.setExtendedProp('progress', progress);
            event.setProp('color', progress === 100 ? '#4CAF50' : '#ff942e'); // Green for completed, orange for incomplete
        }
    }

    function createProjectBox(taskId, taskName, priority, progressPercentage, dueDate, subTasks) {
        let projectBoxWrapper = document.createElement("div");
        projectBoxWrapper.classList.add("project-box-wrapper");

        let projectBox = document.createElement("div");
        projectBox.classList.add("project-box");

        // Change background color if the task is completed
        if (progressPercentage === 100) {
            projectBox.style.backgroundColor = '#e8f5e9'; // Light green for completed tasks
        } else {
            projectBox.style.backgroundColor = getRandomColor();
        }

        // Sort subtasks by their order
        subTasks.sort((a, b) => a.order - b.order);

        let subTaskHtml = subTasks.length > 0 ? `<p>Subtasks:</p><ul>${subTasks.map(subTask => `
            <li>
                <input type='checkbox' class='subtask-checkbox' data-task-id='${taskId}' data-subtask='${subTask.subtask_name}' ${subTask.completed ? 'checked' : ''}>
                ${subTask.subtask_name}
                <button class='check-subtask' data-task-id='${taskId}' data-subtask='${subTask.subtask_name}'>✅</button>
                <button class='delete-subtask' data-task-id='${taskId}' data-subtask='${subTask.subtask_name}'>❌</button>
            </li>
        `).join('')}</ul>` : "";

        let daysLeftText = calculateDaysLeft(dueDate);

        projectBox.innerHTML = `
            <button class="edit-task" data-task-id="${taskId}">✏️</button>
            <button class='delete-task' data-task-id='${taskId}'>❌</button>
            <div class="project-box-content-header">
                <p class="box-content-header">${taskName}</p>
                <p class="box-content-subheader">${priority}</p>
            </div>
            <div class="box-progress-wrapper">
                <p class="box-progress-header">Progress</p>
                <div class="box-progress-bar">
                    <span class="box-progress" data-task-id='${taskId}' style="width: ${progressPercentage}%; background-color: ${progressPercentage === 100 ? '#4CAF50' : '#ff942e'}"></span>
                </div>
                <p class="box-progress-percentage" data-task-id='${taskId}'>${progressPercentage}%</p>
            </div>
            <div class="subtask-list">
                ${subTaskHtml}
            </div>
            <div class="project-box-footer">
                <div class="days-left" data-task-id='${taskId}' data-due-date='${dueDate}'>
                    ${progressPercentage === 100 ? "Completed" : daysLeftText}
                </div>
            </div>
        `;

        // Add event listeners for delete, edit, and subtask completion
        projectBox.querySelector('.delete-task').addEventListener('click', () => deleteTask(taskId));
        projectBox.querySelectorAll('.delete-subtask').forEach(button => {
            button.addEventListener('click', (event) => {
                const subtaskName = event.target.getAttribute('data-subtask');
                deleteSubtask(taskId, subtaskName);
            });
        });

        projectBox.querySelectorAll('.check-subtask').forEach(button => {
            button.addEventListener('click', (event) => {
                const subtaskName = event.target.getAttribute('data-subtask');
                const checkbox = event.target.parentElement.querySelector('.subtask-checkbox');
                const isCompleted = checkbox.checked;
                toggleSubtaskCompletion(taskId, subtaskName, isCompleted);
            });
        });

        projectBox.querySelector('.edit-task').addEventListener('click', () => {
            // Populate the form with task details
            document.getElementById("taskName").value = taskName;
            document.getElementById("priority").value = priority;
            document.getElementById("deadline").value = dueDate;

            // Populate subtask inputs
            const subtaskInputs = document.querySelectorAll('.subtask-input');
            subtaskInputs.forEach((input, index) => {
                input.value = subTasks[index]?.subtask_name || "";
            });

            // Enter edit mode
            isEditMode = true;
            currentTaskId = taskId;
            document.getElementById("addTask").textContent = "Save Task"; // Change button text
            modal.style.display = 'flex'; // Show the modal
        });

        document.getElementById("projectBoxes").appendChild(projectBox);
    }

    function calculateDaysLeft(dueDate) {
        let deadlineDate = new Date(dueDate);
        let today = new Date();

        // Normalize both dates to midnight to avoid time-related discrepancies
        deadlineDate.setHours(0, 0, 0, 0);
        today.setHours(0, 0, 0, 0);

        // Calculate the difference in days
        let difference = Math.ceil((deadlineDate - today) / (1000 * 60 * 60 * 24));

        if (difference < 0) {
            return "Deadline Passed";
        } else if (difference === 0) {
            return "Due Today";
        } else {
            return `${difference} Days Left`;
        }
    }

    function clearForm() {
        document.getElementById("taskName").value = "";
        document.getElementById("priority").value = "High";
        document.getElementById("deadline").value = "";
        const subtaskInputs = document.querySelectorAll('.subtask-input');
        subtaskInputs.forEach(input => input.value = "");
    }

    async function fetchTasks() {
        const { data: tasks, error: taskError } = await database
            .from('tasks')
            .select('*');

        if (taskError) {
            console.error('Error fetching tasks:', taskError);
            return;
        }

        document.getElementById("projectBoxes").innerHTML = '';

        let now = new Date();
        let deadlinePast = 0;
        let workingOnIt = 0;
        let completedTasks = 0;
        let totalTasks = tasks.length;

        for (let task of tasks) {
            const { data: subtasks, error: subtaskError } = await database
                .from('subtasks')
                .select('*')
                .eq('task_id', task.id)
                .order('order', { ascending: true });

            if (subtaskError) {
                console.error('Error fetching subtasks:', subtaskError);
                continue;
            }

            // Create the project box
            createProjectBox(task.id, task.task_name, task.priority, task.progress, task.due_date, subtasks);

            let taskDeadline = new Date(task.due_date);

            if (task.progress === 100) {
                completedTasks++; // Task is completed
            } else if (taskDeadline < now) {
                deadlinePast++; // Task is overdue
            } else {
                workingOnIt++; // Task is still active
            }
        }

        // Update the UI with the task counts
        document.querySelector('.status-number.deadline-past').textContent = deadlinePast;
        document.querySelector('.status-number.working-on-it').textContent = workingOnIt;
        document.querySelector('.status-number.total-tasks').textContent = totalTasks;
        document.querySelector('.status-number.completed-tasks').textContent = completedTasks;

        // Update the calendar with completed tasks
        updateCalendar(tasks);

        // Check for deadlines
        checkDeadlines(tasks);
    }

    function updateCalendar(tasks) {
        if (!calendar) return; // Ensure the calendar is initialized

        // Clear existing events
        calendar.removeAllEvents();

        // Add new events
        tasks.forEach(task => {
            calendar.addEvent({
                title: task.task_name,
                start: task.due_date,
                end: task.due_date,
                color: task.progress === 100 ? '#4CAF50' : '#ff942e', // Green for completed, orange for incomplete
                extendedProps: {
                    progress: task.progress, // Store progress for dynamic styling
                },
            });
        });

        // Re-render the calendar
        calendar.render();
    }

    function updateCalendar(tasks) {
        const calendarEl = document.getElementById('calendar');
        if (!calendarEl) return; // Ensure the calendar element exists

        const calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            events: tasks.map(task => ({
                title: task.task_name,
                start: task.due_date,
                end: task.due_date,
                color: task.progress === 100 ? '#4CAF50' : '#ff942e', // Green for completed, orange for incomplete
            })),
        });

        calendar.render();
    }

    function updateCalendar(tasks) {
        const calendarEl = document.getElementById('calendar');
        if (!calendarEl) return; // Ensure the calendar element exists

        const calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            events: tasks.map(task => ({
                title: task.task_name,
                start: task.due_date,
                end: task.due_date,
                color: task.progress === 100 ? '#4CAF50' : '#ff942e', // Green for completed, orange for incomplete
            })),
        });

        calendar.render();
    }

    //alarm

    function checkDeadlines(tasks) {
        let now = new Date();
    
        tasks.forEach(task => {
            let dueDate = new Date(task.due_date);
            dueDate.setHours(0, 0, 0, 0);
            now.setHours(0, 0, 0, 0);
    
            if (dueDate.getTime() === now.getTime()) {
                console.log(`Task "${task.task_name}" is due today!`);
                alert(`Task "${task.task_name}" is due today!`);
            }
        });
    }
    

    const audio = new Audio('./sounds/alert.mp3');
    audio.play();

    function updateDateTime() {
        const now = new Date();
        const options = { month: 'long', day: 'numeric', year: 'numeric' };
        document.querySelector('.time').textContent = now.toLocaleDateString('en-US', options);
    }

    // Update immediately
    updateDateTime();

    // Refresh every second (optional)
    setInterval(updateDateTime, 1000);

    // Fetch tasks on page load
    fetchTasks();

    setInterval(fetchTasks, 3600000);
    setTimeout(() => {
        alert(`A task is past due!`);
    }, 3);
    
});
</script>
</html>